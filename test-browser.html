<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python to IGCSE Converter - Browser Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .input-section, .output-section {
            margin-bottom: 30px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        textarea {
            width: 100%;
            height: 200px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
        }
        textarea:focus {
            border-color: #007acc;
            outline: none;
        }
        button {
            background-color: #007acc;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #005a9e;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .output {
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 4px;
            padding: 12px;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        .success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .stats {
            margin-top: 15px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
            font-size: 12px;
        }
        .examples {
            margin-top: 20px;
        }
        .example-button {
            background-color: #6c757d;
            font-size: 14px;
            padding: 8px 16px;
            margin: 5px;
        }
        .example-button:hover {
            background-color: #545b62;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêç‚û°Ô∏èüìù Python to IGCSE Pseudocode Converter</h1>
        
        <div class="input-section">
            <label for="pythonInput">Python Code:</label>
            <textarea id="pythonInput" placeholder="Enter your Python code here...">print("Hello, World!")
name = input("What's your name? ")
print(f"Hello, {name}!")</textarea>
        </div>
        
        <div>
            <button onclick="convertCode()">Convert to IGCSE</button>
            <button onclick="validateCode()">Validate Syntax</button>
            <button onclick="clearAll()">Clear All</button>
        </div>
        
        <div class="examples">
            <strong>Examples:</strong>
            <button class="example-button" onclick="loadExample('hello')">Hello World</button>
            <button class="example-button" onclick="loadExample('if')">If Statement</button>
            <button class="example-button" onclick="loadExample('loop')">For Loop</button>
            <button class="example-button" onclick="loadExample('function')">Function</button>
        </div>
        
        <div class="output-section">
            <label for="output">IGCSE Pseudocode Output:</label>
            <div id="output" class="output">Click "Convert to IGCSE" to see the pseudocode output here...</div>
            <div id="stats" class="stats" style="display: none;"></div>
        </div>
    </div>

    <script src="dist/browser/python2igcse.min.js"></script>
    <script>
        // Examples
        const examples = {
            hello: `print("Hello, World!")
name = input("What's your name? ")
print(f"Hello, {name}!")`,
            if: `score = int(input("Enter your score: "))
if score >= 90:
    print("Grade A")
elif score >= 80:
    print("Grade B")
elif score >= 70:
    print("Grade C")
else:
    print("Grade F")`,
            loop: `numbers = [1, 2, 3, 4, 5]
total = 0
for num in numbers:
    total += num
print(f"Total: {total}")`,
            function: `def calculate_area(length, width):
    area = length * width
    return area

length = float(input("Enter length: "))
width = float(input("Enter width: "))
result = calculate_area(length, width)
print(f"Area: {result}")`
        };

        function loadExample(type) {
            document.getElementById('pythonInput').value = examples[type];
            clearOutput();
        }

        function convertCode() {
            const pythonCode = document.getElementById('pythonInput').value;
            const outputDiv = document.getElementById('output');
            const statsDiv = document.getElementById('stats');
            
            if (!pythonCode.trim()) {
                showError('Please enter some Python code to convert.');
                return;
            }
            
            try {
                // Use the global Python2IGCSE class
                const converter = new Python2IGCSE.Python2IGCSEBrowser();
                const startTime = performance.now();
                const result = converter.convertCode(pythonCode);
                const endTime = performance.now();
                
                if (result.success) {
                    outputDiv.className = 'output success';
                    outputDiv.textContent = result.code;
                    
                    // Show stats
                    statsDiv.style.display = 'block';
                    statsDiv.innerHTML = `
                        <strong>Conversion Stats:</strong><br>
                        ‚úÖ Success: ${result.success}<br>
                        ‚è±Ô∏è Time: ${(endTime - startTime).toFixed(2)}ms<br>
                        üìä Parse Time: ${result.stats.parseTime}ms<br>
                        üìù Emit Time: ${result.stats.emitTime}ms<br>
                        üìè Input Lines: ${result.stats.inputLines}<br>
                        üìÑ Output Lines: ${result.stats.outputLines}<br>
                        ‚ö†Ô∏è Warnings: ${result.parseResult.warnings.length}<br>
                        ‚ùå Errors: ${result.parseResult.errors.length}
                    `;
                } else {
                    showError('Conversion failed:\n' + result.parseResult.errors.join('\n'));
                    if (result.parseResult.warnings.length > 0) {
                        outputDiv.textContent += '\n\nWarnings:\n' + result.parseResult.warnings.join('\n');
                    }
                }
            } catch (error) {
                showError('Error during conversion: ' + error.message);
                console.error('Conversion error:', error);
            }
        }

        function validateCode() {
            const pythonCode = document.getElementById('pythonInput').value;
            const outputDiv = document.getElementById('output');
            
            if (!pythonCode.trim()) {
                showError('Please enter some Python code to validate.');
                return;
            }
            
            try {
                const converter = new Python2IGCSE.Python2IGCSEBrowser();
                const result = converter.validateSyntax(pythonCode);
                
                if (result.isValid) {
                    outputDiv.className = 'output success';
                    outputDiv.textContent = '‚úÖ Python syntax is valid!';
                    if (result.warnings.length > 0) {
                        outputDiv.textContent += '\n\nWarnings:\n' + result.warnings.join('\n');
                    }
                } else {
                    showError('‚ùå Python syntax errors found:\n' + result.errors.join('\n'));
                }
            } catch (error) {
                showError('Error during validation: ' + error.message);
                console.error('Validation error:', error);
            }
        }

        function showError(message) {
            const outputDiv = document.getElementById('output');
            const statsDiv = document.getElementById('stats');
            outputDiv.className = 'output error';
            outputDiv.textContent = message;
            statsDiv.style.display = 'none';
        }

        function clearOutput() {
            const outputDiv = document.getElementById('output');
            const statsDiv = document.getElementById('stats');
            outputDiv.className = 'output';
            outputDiv.textContent = 'Click "Convert to IGCSE" to see the pseudocode output here...';
            statsDiv.style.display = 'none';
        }

        function clearAll() {
            document.getElementById('pythonInput').value = '';
            clearOutput();
        }

        // Check if the library loaded correctly
        window.addEventListener('load', function() {
            if (typeof Python2IGCSE === 'undefined') {
                showError('‚ùå Python2IGCSE library failed to load. Please check the console for errors.');
            } else {
                console.log('‚úÖ Python2IGCSE library loaded successfully!');
                // Make Python2IGCSEBrowser available for tests
                window.Python2IGCSEBrowser = Python2IGCSE.Python2IGCSEBrowser;
            }
        });
    </script>
</body>
</html>